---
title: "ProyectoTD2024"
output: html_document
author: "Eric Villaescusa, Isaac Pazmiño, Alexandra Estela, Oscar Ibañez"
date: "2024-03-30"
---

```{r setup, include=FALSE}
#Cargamos las librerias necesarias
knitr::opts_chunk$set(echo = TRUE)
library(readr)
library(dplyr)
library(rlist)
```

```{r}
#Cargamos los nombres de cada tiket (guardados en la carpeta data)
files <- list.files(path = "./data", pattern = ".txt", full.names = TRUE)

#Creamos una lista que contendrá cada ticket.
tickets <- list()

#Asignamos las líneas de los archivos .txt
for (file in files) {
  linea <- read_lines(file, locale = locale(encoding = 'latin1'))
  supermercado <- linea[1]
  direccion <- linea[2]
  ciudad <- linea[3]
  telefono <- linea[4]
  fecha <- linea[5]
  factura <- linea[6]
  indiceinicio <- grep("DESCRIPCIÓN", linea)
  indicefinal <- grep("TOTAL", linea)
  productos <- linea[indiceinicio + 1:indicefinal - 1]
  #Falta IVA
  tarjetabancaria <- linea[indicefinal + 7]
  
#Creamos un data frame con los datos asignados
  datos <- data.frame(
    Supermercado <- supermercado,#Falta distinguir entre los distintos productos porque tienen distintos formatos
    Dirección <- direccion,
    Ciudad <- ciudad,
    Telefono <- telefono,
    Fecha <- fecha,
    Factura <- factura,
    #Falta añadir productos, error con el número de columnas (ARREGLAR)
    stringsAsFactors = FALSE
  #Falta asignar el IVA
)
  #Le asigno cada ticket a cada elemento de la lista
  tickets <- list.append(tickets, datos)
}

#Creamos un dataframe vacio donde añadiremos la información contenida en cada ticket.
datoscompletos <- data.frame()

#Le añadimos a cada columna del data frame un ticket.
for (ticket in tickets) {
  datoscompletos <- rbind(datoscompletos,ticket)
}

```
 

